SET TERM ^ ;
CREATE PROCEDURE SP_ENVSETENVIOSALIDA(
  K_EXPORTACION Varchar(20),
  K_CODI_ADUAN Varchar(3),
  K_ANO_ORDEN Varchar(4),
  K_NUME_ORDEN Varchar(6),
  K_ANO_PRESE Varchar(4),
  K_TIPO_CNT Varchar(1),
  K_NUME_CNT Varchar(15),
  K_ANO_DOCASO Varchar(4),
  K_CODI_REGI Varchar(2),
  K_CODI_OPERA Varchar(2),
  K_NUM_DOCASO Varchar(6),
  K_TIPO_DOCUM Varchar(1),
  K_LIBR_TRIBU Varchar(11),
  K_PESO_NETO Decimal(10,2),
  K_TARA Decimal(10,2),
  K_N_PRE_ADUA Varchar(15),
  K_N_PRE_OTRO Varchar(15),
  K_TAMANO Integer,
  K_TIPO_INGRE Varchar(1),
  K_CODI_CONDI Varchar(3),
  K_DESC_MERC Varchar(250),
  K_NAVE Varchar(50),
  K_ANO_MANIF Varchar(4),
  K_NUME_MANIF Varchar(5),
  K_MOTI_ANULA Varchar(250),
  K_FECH_SALI Integer,
  K_HORA_SALI Varchar(8),
  K_ADU_DOCASO Varchar(3),
  K_PAIS_DESTI Varchar(2),
  K_COD_ANULA Varchar(3),
  K_ULT_TRANS Varchar(2))
AS
DECLARE VARIABLE V_ENVIO INTEGER;
DECLARE VARIABLE V_CONT INTEGER;
BEGIN
    SELECT COUNT(*) FROM ADUENVIO WHERE CODIGO_ADUMANIFIESTO=:K_EXPORTACION
    INTO :V_CONT;
    V_ENVIO=SUBSTRING(:K_EXPORTACION FROM 9);
    IF (:V_CONT=0) THEN
    BEGIN
        INSERT INTO ADUENVIOSALIDA(CODIGO_ADUMANIFIESTO,CODI_ADUAN,ANO_ORDEN,NUME_ORDEN,ANO_PRESE,TIPO_CNT,NUME_CNT,ANO_DOCASO,CODI_REGI,CODI_OPERA,NUM_DOCASO,TIPO_DOCUM,LIBR_TRIBU,PESO_NETO,TARA,N_PRE_ADUA,N_PRE_OTRO,TAMANO,TIPO_INGRE,CODI_CONDI,DESC_MERC,NAVE,ANO_MANIF,NUME_MANIF,MOTI_ANULA,FECH_SALI,HORA_SALI,ADU_DOCASO,PAIS_DESTI,COD_ANULA,ULT_TRANS)
        VALUES(:K_EXPORTACION,:K_CODI_ADUAN,:K_ANO_ORDEN,:K_NUME_ORDEN,:K_ANO_PRESE,:K_TIPO_CNT,:K_NUME_CNT,:K_ANO_DOCASO,:K_CODI_REGI,:K_CODI_OPERA,:K_NUM_DOCASO,:K_TIPO_DOCUM,:K_LIBR_TRIBU,:K_PESO_NETO,:K_TARA,:K_N_PRE_ADUA,:K_N_PRE_OTRO,:K_TAMANO,:K_TIPO_INGRE,:K_CODI_CONDI,:K_DESC_MERC,:K_NAVE,:K_ANO_MANIF,:K_NUME_MANIF,:K_MOTI_ANULA,:K_FECH_SALI,:K_HORA_SALI,:K_ADU_DOCASO,:K_PAIS_DESTI,:K_COD_ANULA,:K_ULT_TRANS);
    END
    ELSE
    BEGIN
        UPDATE ADUENVIOSALIDA SET CODI_ADUAN=:K_CODI_ADUAN,ANO_ORDEN=:K_ANO_ORDEN,NUME_ORDEN=:K_NUME_ORDEN,ANO_PRESE=:K_ANO_PRESE,TIPO_CNT=:K_TIPO_CNT,NUME_CNT=:K_NUME_CNT,ANO_DOCASO=:K_ANO_DOCASO,CODI_REGI=:K_CODI_REGI,CODI_OPERA=:K_CODI_OPERA,NUM_DOCASO=:K_NUM_DOCASO,TIPO_DOCUM=:K_TIPO_DOCUM,LIBR_TRIBU=:K_LIBR_TRIBU,PESO_NETO=:K_PESO_NETO,TARA=:K_TARA,N_PRE_ADUA=:K_N_PRE_ADUA,N_PRE_OTRO=:K_N_PRE_OTRO,TAMANO=:K_TAMANO,TIPO_INGRE=:K_TIPO_INGRE,CODI_CONDI=:K_CODI_CONDI,DESC_MERC=:K_DESC_MERC,NAVE=:K_NAVE,ANO_MANIF=:K_ANO_MANIF,NUME_MANIF=:K_NUME_MANIF,MOTI_ANULA=:K_MOTI_ANULA,FECH_SALI=:K_FECH_SALI,HORA_SALI=:K_HORA_SALI,ADU_DOCASO=:K_ADU_DOCASO,PAIS_DESTI=:K_PAIS_DESTI,COD_ANULA=:K_COD_ANULA,ULT_TRANS=:K_ULT_TRANS
        WHERE CODIGO_ADUMANIFIESTO=:K_EXPORTACION;
    END
END^
SET TERM ; ^
